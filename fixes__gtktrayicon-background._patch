--- a/gtk/deprecated/gtktrayicon-x11.c
+++ b/gtk/deprecated/gtktrayicon-x11.c
@@ -37,6 +37,8 @@
 #include "gtktypebuiltins.h"
 #include "gtkrender.h"
 
+#include "gdkinternals.h"
+
 #define SYSTEM_TRAY_REQUEST_DOCK    0
 #define SYSTEM_TRAY_BEGIN_MESSAGE   1
 #define SYSTEM_TRAY_CANCEL_MESSAGE  2
@@ -966,6 +968,7 @@
   else
     {
       /* Set a parent-relative background pixmap */
+      window->is_tray = TRUE;
       gdk_window_set_background_pattern (window, NULL);
     }
 G_GNUC_END_IGNORE_DEPRECATIONS
--- a/gdk/gdkinternals.h
+++ b/gdk/gdkinternals.h
@@ -330,6 +330,7 @@
   guint modal_hint : 1;
   guint composited : 1;
   guint has_alpha_background : 1;
+  guint is_tray : 1;
 
   guint destroyed : 2;
 
--- a/gdk/x11/gdkwindow-x11.c
+++ b/gdk/x11/gdkwindow-x11.c
@@ -2982,6 +2982,21 @@
 
   if (pattern == NULL)
     {
+      if (window->is_tray)
+        {
+          GdkWindow *parent;
+
+          /* X throws BadMatch if the parent has a different depth when
+           * using ParentRelative */
+          parent = gdk_window_get_parent (window);
+          if (parent && window->depth == parent->depth)
+            {
+              XSetWindowBackgroundPixmap (GDK_WINDOW_XDISPLAY (window),
+                                          GDK_WINDOW_XID (window), ParentRelative);
+              return;
+            }
+        }
+
       XSetWindowBackgroundPixmap (GDK_WINDOW_XDISPLAY (window),
                                   GDK_WINDOW_XID (window), None);
       return;
